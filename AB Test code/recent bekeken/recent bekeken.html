<script>
setTimeout(function(){ 
//get all the data from the current PDP needed to make product tiles (udata should be populated before AB test tool Adobe Target is ready)
console.log("start recent bekeken A/B start");
var pageTemplate = document.querySelector('meta[name="pageGroup"]').content;

if (pageTemplate == "Product" || pageTemplate == "Kit") {
	console.log('this is a productpage')
var link = window.location.href;
var productID = udata.currentPage.products[0].id;
var productName = document.getElementsByClassName("main_header")[0].innerText;
var productPrice = udata.currentPage.products[0].price;
var productImgBig = document.querySelector("#productMainImage").src;
var productImg = productImgBig.replace("646x1000","200x310");
};

var recentProduct = { productID: productID, productName: productName,productPrice: productPrice,productImg: productImg,productLink: link};
var content = document.querySelector("#contentWrapper");
var recentblok = document.querySelector("#recentblok");
var recentblokproducts = document.querySelector("#recentblokproducts");


// there is recent product local storage object, check if it is exists and is empty, if not create the object and populate with current product. If it exists check if it already contains 8 products ( as this is the maximum amount of product we will show in recent products carousel, else check if current product isn't already in list ELSE just add the current product the the existing list smaller than 8 )

var recentProducts = JSON.parse(localStorage.getItem("recent-products")); //create var out of local storage object
console.log(recentProducts);
if (recentProducts) {
var inList = recentProducts.every(checkID);
    function checkID(product) {
      return product.productID !== productID;
    };
};
console.log('inlist = ' + inList);

if (pageTemplate == "Product" || pageTemplate == "Kit")  {
	console.log('this is a product page check update local localStorage')
if (recentProducts == null || recentProducts == undefined) {
	  var recentProducts = [recentProduct];
      localStorage.setItem('recent-products', JSON.stringify(recentProducts));
    } else if (inList == false) {
        console.log('inlist = ' + inList)
        console.log("already in recent product list");
    } 
    else if (recentProducts.length >= 8){
		recentProducts.shift();
		recentProducts.push(recentProduct);
        localStorage.setItem('recent-products', JSON.stringify(recentProducts));
	} else {
		recentProducts.push(recentProduct);
        localStorage.setItem('recent-products', JSON.stringify(recentProducts));
    };
};
 	

// bestaat de recent producten blok al op de pagina ? voeg toe ipv nieuwe blok te creëren
if (recentblok){
	console.log("recent products are already shown")
	contentAdd();
} else {
	console.log("recent products not yet shown, lets add them to the page unless empty")
	contentNew();
};
	function contentAdd() {
	recentblokproducts.innerHTML = "";
 	for (let i = 0; i < recentProducts.length; i++) {
    recentblokproducts.innerHTML += '<a href="' + recentProducts[i].productLink + '">' + '<div class="imgrecent"><img src="' + recentProducts[i].productImg + '"></div>' + '<p>' + recentProducts[i].productName + '</p>' + '<div class="pricerecent"><span>€</span>' + recentProducts[i].productPrice + '</div>' + '</a>';
};
};
	function contentNew() {
	if (recentProducts){
    var nodeh2 = document.createElement("h2"); 
    nodeh2.classList.add("recenth2");
    nodeh2.id = "recentblok";
    nodeh2.innerHTML = "Eerder bekeken";
    content.appendChild(nodeh2);
 	var node = document.createElement("div"); 
 	node.classList.add("catnav-circles");
 	node.id = "recentblokproducts";
    content.appendChild(node);
    var recentblokproducts = document.querySelector("#recentblokproducts");
    var inner = document.createElement("div"); 
    inner.classList.add("inner");
    inner.id = "inner";
 	for (let i = 0; i < recentProducts.length; i++) {
    inner.innerHTML += '<a href="' + recentProducts[i].productLink + '">' + '<div class="imgrecent"><img src="' + recentProducts[i].productImg + '"></div>' + '<p>' + recentProducts[i].productName + '</p>' + '<div class="pricerecent"><span>€</span>' + recentProducts[i].productPrice + '</div>' + '</a>';
 	recentblokproducts.appendChild(inner);
	}
	} else {
		console.log("no recent products to show");
	};
};
}, 1000);
 </script>
<style>
    .catnav-circles {
        /*display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;*/
        overflow-x: auto;
        overflow-y: hidden;
        /*-ms-overflow-style: none;
        scrollbar-width: none;*/
        width: auto;
        min-width: 100%;
        min-height: 100%;
    }
    .inner {
    /* width: auto; */
    /* min-width: 100%; */
    /* min-height: 100%; */
    display: flex;
    flex-direction: row-reverse;
    justify-content: flex-end;
    }
    .catnav-circles::-webkit-scrollbar {
        display: none !important;
    }
    .catnav-circles a {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        padding: 8px;
        width:130px;
        min-height: 200px;
	    border-radius: 15px;
	    border-width: thin;
	    border-color: #ccc;
	    border-style: solid;
	    justify-content: space-around;
	    margin-right: 12px;
    }
    .imgrecent {
    margin: auto;
    width: 100px;
	}
    .catnav-circles a img {
        width: auto;
        height: auto;
        /*height: -moz-available; 
	    height: -webkit-fill-available;
        height: fill available;*/
	    max-height: 100px;
	    max-width: 100px;
	    margin: 0 auto;
        /*display: block;*/
        /*padding-left: 5%;*/
    }
    .catnav-circles a p {
        color: #005BA9;
        text-align: center;
        line-height: 1em;
        margin-top: 10px;
        -webkit-hyphens: auto;
        -ms-hyphens: auto;
        hyphens: auto;
        font-size: 14px;
        min-height: 42px;
    	max-height: 42px;
    	overflow: hidden;
    }
    .recenth2 {
		margin-top: 32px;
	    margin-bottom: 24px;
	    color: #005ba9;
	    font-size: 24px;
	    line-height: 22px;
	    font-family: "Roboto Condensed",sans-serif;
	    font-weight: 400;
	}	
	.pricerecent {
    margin-top: 8px;
	}
</style>